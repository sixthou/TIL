# 10장. 알림 시스템 설계
- 고객에게 중요할 만한 정보를 비동기적으로 제공한다.
- 모바일 푸시 알림, SMS 메시지, 이메일

## 개략적 설계안
- 알림 유형별 지원 방법
  - ios 푸시 알림
    - 알림 제공자 -> APNS -> iOS 단말 
    - 알림 제공자 : 알림 요청을 만들어 애플 푸시 알림 서비스 보내는 주체
    - APNS : 애플이 제공하는 푸시 원격 서비스
  - 안드로이드 푸시 알림
    - 알림 제공자 -> FCM -> 안드로이드 단말
  - SMS 메시지
    - 알림제공자 -> SMS 서비스 -> SMS 수신 단말
  - 이메일
    - 알림제공자 -> 이메일 서비스 -> SMS 수신 단말
- 연락처 정보 수집 절차
  - 사용자가 앱을 설치하거나 처음 계정을 등록하면 해당 정보를 데이터베이승에 저장한다.

- 알림 전송 및 수신 절차
  - 서비스 - 알림시스템 - 알림 유형별 큐
  - 알림서버 제공 기능
    - 알림 전송 API : 인증된 클라이언트만 이용 가능
    - 알림 검증 : 이메일 주소, 전화번호 등 기본적 검증 수행
    - 데이터베이스 또는 캐시 질의 : 알림을 포함시킬 데이터를 가져오는 기능
    - 알림 전송 : 알림 데이터를 메시지 큐에 넣는다.
    - 캐시 : 사용자 정보, 단말 정보, 알림 템플릿 등을 캐시한다.
    - 데이터베이스 : 사용자, 알림, 설정 등 정보 저장
    - 메시지 큐 : 시스템 컴포넌트간 의전성 제거하기 위해 사용
    - 작업 서버 : 전송할 알림을 꺼내서 제3자 서비스로 전달하는 역할
  - 시퀀스
    1. API 호출하여 알림 서버로 알림을 보내다.
    2. 알림 서버는 사용자 정보, 단말 토큰, 알림 설정 같은 메타데이터를 캐시나 데이터베이에서 간져온다.
    3. 알림 서버는 전송할 알림에 맞는 이벤트를 만들어서 해당 이벤트를 위한 큐에 넣는다.
    4. 작업 서버는 메시지 큐에서 알림 이벤트를 꺼낸다.
    5. 작업 서버는 알림을 제3자 서비스로 보낸다.
    6. 제3자 서비스는 사용자 단말로 알림을 전송한다.

## 상세설계
- 안정성(reliability): 메시지 전송 실패율을 낮추기 위해 안정적인 재시도 매커니즘을 도입해야 한다.
- 보안(security): 인증된 클라이언트만이 알림을 보낼 수 있도록 appKey, appSecret 등의 메커니즘을 이용한다.
- 이벤트 추적 및 모니터링: 알림이 만들어진 후 성공적으로 전송되기까지의 과정을 추적하고 시스템 상태를 모니터 링하기 위해 알림 전송의 각 단계마 다 이벤트를 추적하고 모니터링할 수 있어야 한다.
- 사용자 설정 :  사용자가 알림 수신 설정을 조정할 수 있도록 해야한다. 알림을 보내기 전 반드시 해당 설정을 확인하도록 해야한다.
- 전송률 제한 : 사용자에게 알림을 보내는 빈도를 제한할 수 있도록 해야한다.
