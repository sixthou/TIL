# 7장. 분산 시스템을 위한 유일 ID 생성기 설계
- 분산 시스템에서는 auto_increment 를 사용할 수 없다

## 기본 가정
- ID는 유일해야한다.
- ID는 숫자로만 구성되어야 한다.
- ID는 64비트로 표현될 수 있어야 한다.
- ID는 발급 날짜에 따라 정렬 가능해야한다.
- 초당 10,000개의 ID를 만들 수 잇어야 한다.


## 분산 스템에서 유일성이 보장되는 ID를 만드는 방법

### 다중 마스터 복제
- 데이터의 auto_increment 기능 활용
- ID의 값이 1만큼이 아니라 현재 상요중인 데이터 베이스 서버의 수 만큼 증가.
- 여러 데이터 센터에 걸쳐 규모를 늘리기 어렵다.
- ID의 유일성은 보장되지만, 시간 흐름에 맞추어 커지도록 보장은 못한다.
- 서버를 추가하거나 삭제할 때도 잘 동작하기 어렵다.

### UUID
- 컴퓨터 시스템에 저장되는 정보를 유일하게 식별하기 위한 128비트짜리 수
- 09c93e62-50b4-468d-bf8a-c07e1040bfb2 와 같은 형태
- 서버 간 조율 없이 독립적 생성 가능
- 만드는 것이 단순하며, 동기화 이슈 없다.
- 각 서버가 자기가 쓸 ID를 알아서 만드는 구조로 규모 확장도 쉽다.
- ID가 128 비트로 길다.
- 시간순으로 정렬할 수 없다.
- 숫자아닌 값이 포함될 수 있다.

### 티켓 서버
- auto_increment 기능을 갖춘 티켓서버를 중앙 집중형으로 하나만 사용하는 것
- 유일성이 보장되며, 오직 숫자로만 구성된 ID를 쉽게 만들 수 있다.
- 구현하기 쉽고, 중소 규모 애플리케이션에 적합하다.
- 티켓서버가 SPOF가 된다. -> 장애 발생시 모든 시스템에 영향을 받는다. 

### 트위터 스노플레이크 접근법
- ID 구조를 여러 절로 분할한다.
  - 사인비트 : 1비트 할당
  - 타임스탬프 : 41비트 할당, epoch 이후 밀리초를 나타내는 값
  - 데이터센터 ID : 5비트 할당 -> 32개 데이터 센터 지원 가능
  - 서버 ID : 5비트 할당 -> 데이터센터당 32개 서버 사용 가능
  - 일련번호 : 12비트 할당
    - 각 서버에서 ID를 생성할 때마다 일련번호를 1만큼 증가시킨다., 1밀리초가 경과할 때마다 0으로 초기화
- 데이터센터 Id, 서버 ID 는 시스템 운영 중에는 바뀌지 않는다.
- 타임 스탬프나 일련번호는 ID 생성기가 돌고 있는 중에 만들어지는 값이다.
- 타임 스탬프
  - 시간이 흐름에 따라 증가하므로 시간 순으로 ID는 시간 순으로 정렬 가능하다.
