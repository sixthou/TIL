# 2. 개략적인 규모 추정

- 시스템 설계를 위해서는 시스템 용량이나 성능 요구사항을 개략적으로 추정이 필요함

## 2의 제곱수

| 2의 x 제곱 | 근사치   | 이름     | 축약형 |
|---------|-------|--------|-----|
| 10      | 1천    | 1킬로바이트 | 1KB |
| 20      | 1백만   | 1메가바이트 | 1MB |
| 30      | 10억   | 1기가바이트 | 1GB |
| 40      | 1조    | 1테라바이트 | 1TB |
| 50      | 1000조 | 1페타바이트 | 1PB |

## 모든 프로로그래머가 알아야 하는 응답지연 값

| 연산명                             | 시간            |
|---------------------------------|---------------|
| L1 캐시 참조                        | 0.5ns         |
| 분기 예측 오류                        | 5ns           |
| L2 캐시 참조                        | 7ns           |
| 뮤텍스 락/언락                        | 100ns         |
| 주 메모리 참조                        | 100ns         |
| Zippy로 1KB 압축                   | 10,000ns      |
| 1 Gbps 네트워크로 2KB 전송             | 20,000ns      |
| 메모리에서 1MB 순차적으로 read            | 250,000ns     |
| 같은 데이터 센터 내에서의 메시지 왕복 지연시간      | 500,000ns     |
| 디스크 탐색                          | 10,000,000ns  |
| 네트워크 1MB 순차적으로 read             | 10,000,000ns  |
| 디스크에서 1MB 순차적으로 read            | 30,000,000ns  |
| 한 패킷의 캘리포니아로부터 네덜란드까지의 왕복 지연 시간 | 150,000,000ns |

- 결론
  - 메모리는 빠르지만 디스크는 느리다
  - 디스크 탐색은 가능한 피해야한다.
  - 단순한 압축 알고리즘은 빠르다
  - 데이터를 인터넷으로 전송하기전에 가능하면 압축하라.
  - 데이터 센터는 보통 여러지역에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

## 가용성에 관계된 수치들
- 고가용성 : 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 잇는 능력을 지칭

## QPS와 요구량 추정 방법
- 가정
  - 월간 능동 사용자(MAU)는 3억명이다.
  - 50%의 사용자가 매일 사용한다.
  - 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
  - 미디어를 포함하는 트윗은 10%정도다.
  - 데이터는 5년간 보관한다.

- 추정
  - `QPS`(Query Per Second) 추정치
    - 일간 능동 사용자(DAU) = 3억 * 50% = 1.5억
    - QPS = 1.5억 * 2트윗 / 24시간 / 3600초 = 약 3500
    - 최대 QPS = 2 * QPS = 약 7000
  - 미디어 저장을 위한 저장소 요구량
    - 평균 트윗 크기
      - tweet_id에 64바이트
      - 텍스트에 140바이트
      - 미디어에 1MB
    - 미디어 저장소 요구량 : 1.5억 * 2 * 10% * 1MB = 30TB/일
    - 5년간 미디어를 보관하기 위한 저장소 요구랑 = 30TB * 365 * 5 = 약 55PB
